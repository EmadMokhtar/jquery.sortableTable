(function(a){a.fn.sortableTable=function(f){var i={image_base:null,theme:"default",allow_col_resize:false};var d={};var b=this;var g=b.find("tr:first-child");var e=new RegExp("([a-zA-Z,]|((\b)-(\b)))","g");var h=null;var c=null;this.initSortableTable=function(){if(d.image_base==null){throw"SortableTable widget: no image base specified.";return}b.addClass("sortable-table");var m=g.find("th:first-child").height();g.find("th").each(function(o,q){var r=a(q);if(r.find("div.sort-direction-container").length==0){var p=a("<img />").attr({src:d.image_base+"/"+d.theme+"/Transparent.gif",width:"7",height:"4"});var n=a("<div></div>").addClass("sort-direction-container").css({height:m+"px"});if(!d.allow_col_resize){n.css({marginRight:"-7px"})}else{n.addClass("allow-col-resize")}n.append(p);r.append(n)}});var l=b.find("tr").not(":first-child");var j=b.find("tr[data-level=3]");if(j.length>0){j.each(function(o,n){var q=a(n);var p=q.prevAll("tr[data-level=2]").eq(0);q.data("parent_row",p)})}var k=b.find("tr[data-level=2]");if(k.length>0){k.each(function(o,n){var q=a(n);var p=q.prevAll("tr[data-level=1]").eq(0);q.data("parent_row",p)})}var l=b.find("tr").not(":first-child");l.each(function(o,n){var p=a(n);p.find("td").each(function(r,s){var q=a(s);q.data("sort_value",q.text())})});b.data("sortable-table-options",d);b.on("click","tr th",this.sortTableByColumn)};this.sortTableByColumn=function(m){if(m.type=="click"){var n=a(this);var u=(n.attr("data-sort-direction")!=undefined?n.attr("data-sort-direction"):"DESC");b.col_index_clicked=n.index();b.sort_type=(n.attr("data-sort-type")!=undefined?n.attr("data-sort-type"):null);n.siblings().attr("data-sort-direction",null).find("img").css({backgroundImage:""});if(u=="ASC"){n.attr("data-sort-direction","DESC").find("img").css({backgroundImage:'url("'+d.image_base+"/"+d.theme+'/arrow-down.png")'})}else{n.attr("data-sort-direction","ASC").find("img").css({backgroundImage:'url("'+d.image_base+"/"+d.theme+'/arrow-up.png")'})}var q=b.find("tr[data-level=1]");if(q.length==0){q=b.find("tr").not(":first-child")}var x=_.sortBy(q,b.sortFunction);var s=_.sortBy(b.find("tr[data-level=2]"),b.sortFunction);var o=_.sortBy(b.find("tr[data-level=3]"),b.sortFunction);if(u=="DESC"){if(x.length>0){for(var t=x.length-1;t>=0;t--){var y=x[t];g.after(y)}}if(s.length>0){for(var r=s.length-1;r>=0;r--){var w=a(s[r]);var l=a(w.data("parent_row"));l.after(w)}}if(o.length>0){for(var p=o.length-1;p>=0;p--){var v=a(o[p]);var l=a(v.data("parent_row"));l.after(v)}}}else{if(x.length>0){a.each(x,function(z,j){var k=a(j);g.after(k)})}if(s.length>0){a.each(s,function(j,k){var A=a(k);var z=a(A.data("parent_row"));z.after(A)})}if(o.length>0){a.each(o,function(z,j){var k=a(j);var A=a(k.data("parent_row"));A.after(k)})}}}};this.sortFunction=function(p){var m=null;var j=b.col_index_clicked;var l=b.sort_type;var n=a(p).find("td").eq(j);while(n.length==0&&j>=0){j--;n=a(p).find("td").eq(j);var k=a(p).closest("table").find("tr").eq(0).find("th").eq(j);l=(k.attr("data-sort-type")!=undefined?k.attr("data-sort-type"):null)}var o=original_value=n.data("sort_value");o=o.replace(e,"");if(l!=null){if(l=="numeric"){m=isNaN(parseInt(o))?-(Number.MAX_VALUE):parseInt(o)}else{m=original_value.toLowerCase()}}else{m=isNaN(parseInt(o))?original_value.toLowerCase():parseInt(o)}return m};if(typeof f=="string"){d=b.data("sortable-table-options");if(f=="reinit"){this.initSortableTable()}}else{d=a.extend(i,f);this.initSortableTable()}return this}})(jQuery);