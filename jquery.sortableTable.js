(function(a){a.fn.sortableTable=function(e){var g={image_base:null,theme:"default",allow_col_resize:false};var c={};var b=this;var f=b.find("tr:first-child");var d=new RegExp("([a-zA-Z,]|((\b)-(\b)))","g");this.initSortableTable=function(){if(c.image_base==null){throw"SortableTable widget: no image base specified.";return}b.addClass("sortable-table");var k=f.find("th:first-child").height();f.find("th").each(function(m,o){var p=a(o);if(p.find("div.sort-direction-container").length==0){var n=a("<img />").attr({src:c.image_base+"/"+c.theme+"/Transparent.gif",width:"7",height:"4"});var l=a("<div></div>").addClass("sort-direction-container").css({height:k+"px"});if(!c.allow_col_resize){l.css({marginRight:"-7px"})}else{l.addClass("allow-col-resize")}l.append(n);p.append(l)}});var j=b.find("tr").not(":first-child");var h=b.find("tr[data-level=3]");if(h.length>0){h.each(function(m,l){var o=a(l);var n=o.prevAll("tr[data-level=2]").eq(0);o.data("parent_row",n)})}var i=b.find("tr[data-level=2]");if(i.length>0){i.each(function(m,l){var o=a(l);var n=o.prevAll("tr[data-level=1]").eq(0);o.data("parent_row",n)})}var j=b.find("tr").not(":first-child");j.each(function(m,l){var n=a(l);n.find("td").each(function(p,q){var o=a(q);o.data("sort_value",o.text())})});b.data("sortable-table-options",c);b.on("click","tr th",this.sortTableByColumn)};this.sortTableByColumn=function(l){if(l.type=="click"){var m=a(this);var r=m.index();var u=(m.attr("data-sort-direction")!=undefined?m.attr("data-sort-direction"):"DESC");m.siblings().attr("data-sort-direction",null).find("img").css({backgroundImage:""});if(u=="ASC"){m.attr("data-sort-direction","DESC").find("img").css({backgroundImage:'url("'+c.image_base+"/"+c.theme+'/arrow-down.png")'})}else{m.attr("data-sort-direction","ASC").find("img").css({backgroundImage:'url("'+c.image_base+"/"+c.theme+'/arrow-up.png")'})}var p=b.find("tr[data-level=1]");if(p.length==0){p=b.find("tr").not(":first-child")}var x=_.sortBy(p,function(A){var j=null;var i=r;var k=a(A).find("td").eq(i);while(k.length==0&&i>=0){i--;k=a(A).find("td").eq(i)}var z=k.data("sort_value");var B=z;z=z.replace(d,"");j=isNaN(parseInt(z))?B.toLowerCase():parseInt(z);return j});var s=_.sortBy(b.find("tr[data-level=2]"),function(A){var j=null;var i=r;var k=a(A).find("td").eq(i);while(k.length==0&&i>=0){i--;k=a(A).find("td").eq(i)}var z=k.data("sort_value");var B=z;z=z.replace(d,"");j=isNaN(parseInt(z))?B.toLowerCase():parseInt(z);return j});var n=_.sortBy(b.find("tr[data-level=3]"),function(A){var j=null;var i=r;var k=a(A).find("td").eq(i);while(k.length==0&&i>=0){i--;k=a(A).find("td").eq(i)}var z=k.data("sort_value");var B=z;z=z.replace(d,"");j=isNaN(parseInt(z))?B.toLowerCase():parseInt(z);return j});if(u=="DESC"){if(x.length>0){for(var t=x.length-1;t>=0;t--){var y=x[t];f.after(y)}}if(s.length>0){for(var q=s.length-1;q>=0;q--){var w=a(s[q]);var h=a(w.data("parent_row"));h.after(w)}}if(n.length>0){for(var o=n.length-1;o>=0;o--){var v=a(n[o]);var h=a(v.data("parent_row"));h.after(v)}}}else{if(x.length>0){a.each(x,function(k,i){var j=a(i);f.after(j)})}if(s.length>0){a.each(s,function(i,j){var z=a(j);var k=a(z.data("parent_row"));k.after(z)})}if(n.length>0){a.each(n,function(k,i){var j=a(i);var z=a(j.data("parent_row"));z.after(j)})}}}};if(typeof e=="string"){c=b.data("sortable-table-options");if(e=="reinit"){this.initSortableTable()}}else{c=a.extend(g,e);this.initSortableTable()}return this}})(jQuery);