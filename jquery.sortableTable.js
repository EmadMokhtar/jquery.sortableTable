(function(a){a.fn.sortableTable=function(f){var i={image_base:null,theme:"default",allow_col_resize:false,rows_to_anchor:null};var d={};var b=this;var g=b.find("tr:first-child");var e=new RegExp("([a-zA-Z,]|((\b)-(\b)))","g");var h=null;var c=null;this.initSortableTable=function(){if(d.image_base==null){throw"SortableTable widget: no image base specified.";return}b.addClass("sortable-table");var n=g.find("th:first-child").height();g.find("th").each(function(p,r){var s=a(r);if(s.find("div.sort-direction-container").length==0){var q=a("<img />").attr({src:d.image_base+"/"+d.theme+"/Transparent.gif",width:"7",height:"4"});var o=a("<div></div>").addClass("sort-direction-container").css({height:n+"px"});if(!d.allow_col_resize){o.css({marginRight:"-7px"})}else{o.addClass("allow-col-resize")}o.append(q);s.append(o)}});var j=b.find("tr[data-level=3]");if(j.length>0){j.each(function(p,o){var r=a(o);var q=r.prevAll("tr[data-level=2]").eq(0);r.data("parent_row",q)})}var k=b.find("tr[data-level=2]");if(k.length>0){k.each(function(p,o){var r=a(o);var q=r.prevAll("tr[data-level=1]").eq(0);r.data("parent_row",q)})}var l=b.find("tr").not(":first-child");if(d.rows_to_anchor!=null){var m=l.not(d.rows_to_anchor);if(m.length==0){throw"SortableTable widget: 'rows_to_anchor' option excluded all possible rows to sort"}else{l=m}}l.each(function(p,o){var q=a(o);q.find("td").each(function(s,u){var r=a(u);var t=r.text();if(r.attr("data-sort-property")!=null&&q.attr(r.attr("data-sort-property"))!=null){t=q.attr(r.attr("data-sort-property"))}r.data("sort_value",t)})});b.data("sortable-table-options",d);b.on("click","tr th",this.sortTableByColumn)};this.destroy=function(){b.off("click");b.removeData("sortable-table-options");var j=b.find("tr").not(":first-child");j.removeData("parent_row");j.find("td").removeData("sort_value");g.find("th").removeAttr("data-sort-direction");g.find("th div.sort-direction-container").remove();b.removeClass("sortable-table")};this.sortTableByColumn=function(v){if(v.type=="click"){var p=a(this);var z=p.attr("data-sort-direction");var o=p.attr("data-sort-type");var B=(z!=null?z:"DESC");b.col_index_clicked=p.index();b.sort_type=(o!=null?o:null);p.siblings().removeAttr("data-sort-direction");p.siblings().find("img").css({backgroundImage:""});if(B=="ASC"){p.attr("data-sort-direction","DESC").find("img").css({backgroundImage:'url("'+d.image_base+"/"+d.theme+'/arrow-down.png")'})}else{p.attr("data-sort-direction","ASC").find("img").css({backgroundImage:'url("'+d.image_base+"/"+d.theme+'/arrow-up.png")'})}var y=b.find("tr[data-level=1]");if(y.length==0){y=b.find("tr").not(":first-child")}var D=b.find("tr[data-level=2]");var m=b.find("tr[data-level=3]");if(d.rows_to_anchor!=null){var A=y.not(d.rows_to_anchor);if(y.length==0){throw"SortableTable widget: 'rows_to_anchor' option excluded all possible rows to sort"}else{y=A}D=D.not(d.rows_to_anchor);m=m.not(d.rows_to_anchor)}var r=_.sortBy(y,b.sortFunction);var l=_.sortBy(D,b.sortFunction);var q=_.sortBy(m,b.sortFunction);if(B=="DESC"){if(r.length>0){for(var w=r.length-1;w>=0;w--){var s=r[w];g.after(s)}}if(l.length>0){for(var u=l.length-1;u>=0;u--){var n=a(l[u]);var C=a(n.data("parent_row"));C.after(n)}}if(q.length>0){for(var t=q.length-1;t>=0;t--){var x=a(q[t]);var C=a(x.data("parent_row"));C.after(x)}}}else{if(r.length>0){a.each(r,function(E,j){var k=a(j);g.after(k)})}if(l.length>0){a.each(l,function(j,k){var F=a(k);var E=a(F.data("parent_row"));E.after(F)})}if(q.length>0){a.each(q,function(E,j){var k=a(j);var F=a(k.data("parent_row"));F.after(k)})}}}};this.sortFunction=function(p){var m=null;var j=b.col_index_clicked;var l=b.sort_type;var n=a(p).find("td").eq(j);while(n.length==0&&j>=0){j--;n=a(p).find("td").eq(j);var k=a(p).closest("table").find("tr").eq(0).find("th").eq(j);l=(k.attr("data-sort-type")!=undefined?k.attr("data-sort-type"):null)}var o=original_value=n.data("sort_value");o=o.replace(e,"");if(l!=null){if(l=="numeric"){m=isNaN(parseInt(o))?-(Number.MAX_VALUE):parseInt(o)}else{m=original_value.toLowerCase()}}else{m=isNaN(parseInt(o))?original_value.toLowerCase():parseInt(o)}return m};if(typeof f=="string"){d=b.data("sortable-table-options");if(f=="reinit"){this.destroy();this.initSortableTable()}}else{d=a.extend(i,f);this.initSortableTable()}return this}})(jQuery);